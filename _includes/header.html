<header class="border-b border-gray-300 dark:border-gray-700 dark:text-gray-50">
    <div class="container mx-auto px-4 sm:px-6 flex items-center justify-between py-4 sm:py-6 border-x border-gray-300 dark:border-gray-700 bg-white dark:bg-black">
        <a href="/" class="p-2">
            <img src="/logo.svg" alt="Pixelarticons" class="h-5 sm:h-6 hover:scale-110 hover:-rotate-6 transition-all duration-100">
        </a>
        <nav class="hidden sm:flex items-center gap-2" x-data="{
            currentPath: '',
            navItems: [
                { href: '/', label: 'Icons' },
                { href: '/about', label: 'About' },
                { href: '/examples', label: 'Examples' },
                { href: '/legacy', label: 'Legacy' }
            ],
            init() {
                this.currentPath = window.location.pathname;
            },
            isActive(path) {
                const normalizedPath = this.currentPath.replace(/\/$/, '').replace(/\.html$/, '');
                const normalizedTarget = path.replace(/\/$/, '').replace(/\.html$/, '');
                if (normalizedTarget === '') {
                    return normalizedPath === '' || normalizedPath === '/';
                }
                return normalizedPath === normalizedTarget || normalizedPath.startsWith(normalizedTarget + '/');
            }
        }">
            <template x-for="item in navItems" :key="item.href">
                <a
                    class="flex items-center gap-2 rounded hover:underline group px-4 py-2"
                    :class="isActive(item.href) ? 'underline' : ''"
                    :href="item.href"
                >
                    <span x-text="item.label"></span><span
                        class="size-1 bg-black outline outline-2 outline-black dark:outline-white group-hover:animate-spin group-hover:bg-primary"
                        :class="isActive(item.href) ? 'animate-spin bg-primary' : ''"
                    ></span>
                </a>
            </template>
        </nav>

        <div class="flex items-center gap-2 sm:gap-3">
            <!-- Mobile Menu Button -->
            <div x-data="{
                open: false,
                currentPath: '',
                navItems: [
                    { href: '/', label: 'Icons' },
                    { href: '/about', label: 'About' },
                    { href: '/examples', label: 'Examples' },
                    { href: '/legacy', label: 'Legacy' }
                ],
                init() {
                    this.currentPath = window.location.pathname;
                },
                isActive(path) {
                    const normalizedPath = this.currentPath.replace(/\/$/, '').replace(/\.html$/, '');
                    const normalizedTarget = path.replace(/\/$/, '').replace(/\.html$/, '');
                    if (normalizedTarget === '') {
                        return normalizedPath === '' || normalizedPath === '/';
                    }
                    return normalizedPath === normalizedTarget || normalizedPath.startsWith(normalizedTarget + '/');
                }
            }" class="sm:hidden relative">
                <button @click="open = !open" class="btn !px-2">
                    <svg class="size-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M3 6h18v2H3V6Zm0 5h18v2H3v-2Zm0 5h18v2H3v-2Z"/></svg>
                </button>
                <div
                    x-show="open"
                    @click.away="open = false"
                    x-transition
                    class="absolute right-0 mt-2 w-48 bg-white dark:bg-black border border-gray-300 dark:border-gray-700 rounded shadow-lg z-50"
                >
                    <template x-for="item in navItems" :key="item.href">
                        <a
                            class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
                            :class="isActive(item.href) ? 'bg-gray-100 dark:bg-gray-800' : ''"
                            :href="item.href"
                            x-text="item.label"
                        ></a>
                    </template>
                </div>
            </div>
            <!-- Theme Toggle -->
            <div x-data="{ 
                theme: 'system',
                open: false,
                get currentTheme() {
                    if (this.theme === 'system') {
                        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                    }
                    return this.theme;
                },
                init() {
                    // Load theme from localStorage
                    const stored = localStorage.getItem('theme');
                    if (stored && ['light', 'dark', 'system'].includes(stored)) {
                        this.theme = stored;
                    } else {
                        this.theme = 'system';
                    }
                    this.applyTheme();
                    
                    // Watch for system theme changes
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                        if (this.theme === 'system') {
                            this.applyTheme();
                        }
                    });
                },
                setTheme(newTheme) {
                    this.theme = newTheme;
                    localStorage.setItem('theme', newTheme);
                    this.applyTheme();
                    this.open = false;
                },
                applyTheme() {
                    const effectiveTheme = this.currentTheme;
                    if (effectiveTheme === 'dark') {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                }
            }" class="relative">
                <button 
                    @click="open = !open"
                    class="btn !px-2"
                    :title="'Current theme: ' + theme"
                >
                <svg x-show="currentTheme === 'light'" class="size-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 22H8V20H18V22ZM8 20H6V18H8V20ZM20 20H18V18H20V20ZM6 18H4V16H6V18ZM22 18H20V14H18V12H20V10H22V18ZM4 16H2V6H4V16ZM18 16H12V14H18V16ZM12 14H10V12H12V14ZM10 12H8V6H10V12ZM6 6H4V4H6V6ZM14 4H12V6H10V4H6V2H14V4Z" fill="currentColor"/>
                    </svg>
                    <svg x-show="currentTheme === 'dark'" class="size-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 22H11V19H13V22ZM7 19H5V17H7V19ZM19 19H17V17H19V19ZM15 17H9V15H15V17ZM9 15H7V9H9V15ZM17 15H15V9H17V15ZM5 13H2V11H5V13ZM22 13H19V11H22V13ZM15 9H9V7H15V9ZM7 7H5V5H7V7ZM19 7H17V5H19V7ZM13 5H11V2H13V5Z" fill="currentColor"/>
                        </svg>
                            
                            
                </button>
                <div 
                    x-show="open"
                    @click.away="open = false"
                    x-transition
                    class="absolute right-0 mt-2 w-40 bg-white dark:bg-black border border-gray-300 dark:border-gray-700 rounded shadow-lg z-50"
                >
                    <button 
                        @click="setTheme('light')"
                        :class="theme === 'light' ? 'bg-gray-100 dark:bg-gray-800' : ''"
                        class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
                    >
                        Light
                    </button>
                    <button 
                        @click="setTheme('dark')"
                        :class="theme === 'dark' ? 'bg-gray-100 dark:bg-gray-800' : ''"
                        class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
                    >
                        Dark
                    </button>
                    <button 
                        @click="setTheme('system')"
                        :class="theme === 'system' ? 'bg-gray-100 dark:bg-gray-800' : ''"
                        class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
                    >
                        System
                    </button>
                </div>
            </div>
            
            <a class="btn btn-primary text-xs sm:text-base" href="https://halfmage.gumroad.com/l/pixelarticons">
                <svg class="size-6" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 22H5V20H19V22ZM9 6H15V4H17V6H21V20H19V8H17V10H15V8H9V10H7V8H5V20H3V6H7V4H9V6ZM15 4H9V2H15V4Z" fill="currentColor"/>
                </svg>
                <span class="hidden sm:inline">Buy now</span>
            </a>
        </div>
    </div>
</header>